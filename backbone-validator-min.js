(function(F,u){"use strict";var t=F.Validator={version:"0.0.1",validate:function(F,t,a){var i={};return u.chain(F).each(function(F,u){var e=t[u],n=this._validateByEntries(e,F,a);n&&(i[u]=n)},this),u.size(i)?i:null},addValidator:function(F,u,t,a){if(this._validators[F]&&!a)throw Error('Validator "'+F+'" already exists');this._validators[F]={fn:u,message:t}},_validators:{},_validateByEntries:function(F,t,a){var i=[];return u.chain([F||[]]).flatten().each(function(F){var u=this._validateByEntry(F,t,a);u&&i.push(u)},this),i.length?u.uniq(u.flatten(i)):null},_validateByEntry:function(F,t,a){var i=F.message,e=[];return u.chain(F).omit("message").each(function(F,u){var n=this._validateByName(u,t,F,i,a);n&&e.push(n)},this),e.length?u.uniq(e):null},_validateByName:function(F,u,t,a,i){var e=this._validators[F];if(!e)throw Error("Invalid validator name: "+F);var n=e.fn.apply(i,[u,t]);return a=a||e.message||"Invalid",n?n===!0?null:n:a}};t.Extensions={View:{bindValidation:function(F,a){if(F=F||this.model,!F)throw"Model is not provided";this.listenTo(F,"validated",u.bind(function(F,i,e){a=u.extend({},t.ViewCallbacks,u.pick(this,"onInvalidField","onValidField"),a),e=e||{},u.each(i,function(u,t){var i=e[t];i&&i.length?a.onInvalidField.call(this,t,u,i,F):a.onValidField.call(this,t,u,F)},this)},this))}},Model:{validate:function(F,i){var e=this.validation||{};if(u.isArray(F)||u.isString(F))F=a(this.attributes,F);else if(!F){var n=u.extend({},this.attributes,e);F=a(this.attributes,u.keys(n))}var d=this.errors=t.validate(F,e,this);return i=i||{},i.silent||u.defer(u.bind(this.triggerValidated,this),F,d),i&&i.suppress?null:d},triggerValidated:function(F,u){this.trigger("validated",this,F,u),this.trigger("validated:"+(u?"invalid":"valid"),this,F,this.errors)},isValid:function(F,t){return F=F&&F.length?u.pick(this.attributes,F):null,!this.validate(F,t)}}};var a=function(F,t){return u.inject(u.flatten([t]),function(u,t){return u[t]=F[t],u},{})};t.ViewCallbacks={onValidField:function(F){this.$('input[name="'+F+'"]').removeClass("error").removeAttr("data-error")},onInvalidField:function(F,u,t){this.$('input[name="'+F+'"]').addClass("error").attr("data-error",t.join(", "))}};var i=[{name:"required",message:"Is required",fn:function(F){return!!F}},{name:"collection",fn:function(F){var t=F.models||F,a=u.inject(t,function(F,u,t){var a=u.validate();return a&&F.push([t,a]),F},[]);return a.length?a:!0}},{name:"minLength",message:"Is too short",fn:function(F,u){return F&&F.length>=u}},{name:"maxLength",message:"Is too long",fn:function(F,u){return F&&u>=F.length}},{name:"format",message:"Does not match format",fn:function(F,t){var a={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i};return u.isString(F)&&!!F.match(a[t]||t)}},{name:"fn",fn:function(F,u){return u.call(this,F)}}];u.each(i,function(F){t.addValidator(F.name,F.fn,F.message)}),t.apply=function(a){var i=u.extend({model:F.Model,view:F.View},a||{});i.model&&u.extend(i.model.prototype,t.Extensions.Model),i.view&&u.extend(i.view.prototype,t.Extensions.View)}})(Backbone,_);